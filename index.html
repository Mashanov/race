<!DOCTYPE html>
<html lang="ru" >
<head>
  <meta charset="UTF-8">
  <title>Гонки 3D</title>
</head>
<style>
  @import url("https://fonts.googleapis.com/css?family=Press+Start+2P");

body {
  margin: 0;
  color: white;
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
}

button {
  outline: none;
  cursor: pointer;
  border: none;
  box-shadow: 3px 5px 0px 0px rgba(0, 0, 0, 0.75);
}

a,
a:visited {
  color: inherit;
}

#score {
  position: absolute;
  font-family: "Press Start 2P", cursive;
  font-size: 0.9em;
  color: white;
  transform: translate(-50%, -50%);
  opacity: 0.9;
  max-width: 100px;
  text-align: center;
  line-height: 1.6em;
}

#controls {
  position: absolute;
  bottom: 50px;
  left: 50px;
  display: flex;
}

#controls #buttons {
  width: 80px;
  opacity: 0;
  transition: opacity 2s;
}

#controls button {
    width: 100%;
    height: 80px;
    background-color: #fff;
    border: 1px solid black;
    margin-bottom: 10px;
    border-radius: 50%;
}

#results {
  position: absolute;
  align-items: center;
  justify-content: center;
  height: 100%;
  width: 100%;
  background-color: rgba(20, 20, 20, 0.75);
  display: none;
  z-index: 51;
}

#results .content {
  max-width: 350px;
  padding: 50px;
  border-radius: 20px;
}

#music {
    position: fixed;
    right: 20px;
    top: 20px;
    color: #fff;
    font-size: 200%;
    z-index: 1;
    text-shadow: #000 0 1px 1px;
}

#musicStop {
    display: none;
    pointer-events: none;
    position: absolute;
    z-index: 1;
    right: 20px;
    top: 30px;
    width: 20px;
    height: 20px;
    background-color: #ee7070;
    clip-path: polygon(20% 0%, 0% 20%, 30% 50%, 0% 80%, 20% 100%, 50% 70%, 80% 100%, 100% 80%, 70% 50%, 100% 20%, 80% 0%, 50% 30%);
}

.leftIcon {
    position: relative;
    width: 70px;
    height: 70px;
    background: #0f0f0f73;
    z-index: 1;
    bottom: 50px;
    right: 10px;
    margin-bottom: 10px;
    border-radius: 10px;
    color: #fff;
    text-align: center;
      font-family: "Press Start 2P", cursive;
    font-size: 60%;
}

.imageMenuSection {
    position: absolute;
    width: 50px;
    height: 50px;
    background-position: 50%;
    background-size: cover;
    left: 0;
    right: 0;
    margin: 0 auto;
}

@media (min-height: 425px) {
  #score {
    font-size: 1.5em;
    max-width: 150px;
  }

  #controls {
    display: flex;
  }
}
</style>
<body>
<div id="score">Погнали</div>

<div id="controls">
  <div id="buttons">
    <button id="accelerate">
      <svg width="50" height="50" viewBox="0 0 10 10">
        <g transform="rotate(0, 5,5)">
          <path d="M5,4 L7,6 L3,6 L5,4" />
        </g>
      </svg>
    </button>
    <button id="decelerate">
      <svg width="50" height="50" viewBox="0 0 10 10">
        <g transform="rotate(180, 5,5)">
          <path d="M5,4 L7,6 L3,6 L5,4" />
        </g>
      </svg>
    </button>
  </div>
</div>

<div id="results">
  <div class="content">
    <h1 style="text-align: center;">Вы врезались</h1>
    <p style="text-align: center;background: #0065ff;padding: 7px;border-radius: 7px;cursor: pointer;" onclick="reset ();startGame ()">Начать заного</p>
  </div>
</div>
<div id="music" onclick="aud ()">♫</div>
<div id="musicStop"></div>
<div style="position: fixed;bottom: 0;right: 0;">
  <div class="leftIcon" onclick="vkBridge.send('VKWebAppShowInviteBox')">
    <svg class="imageMenuSection" viewBox="0 0 512 512"><defs><style>.cls-1{fill:#006095;}.cls-2{fill:#0071af;}.cls-3{fill:#fda5a3;}.cls-4{fill:#ec9090;}.cls-5{fill:#353535;}.cls-6{fill:#2d2d2d;}.cls-7{fill:#bebebe;}.cls-8{fill:#6e6e6e;}.cls-9{fill:#00b378;}.cls-10{fill:#dfdfdf;}.cls-11{fill:#338dbf;}.cls-12{fill:#cbe2ef;}.cls-13{fill:#d27676;}.cls-14{fill:#f4f4f4;}.cls-15{fill:#d78d8b;}.cls-16{fill:#c97b7b;}.cls-17{fill:#a2a2a2;}.cls-18{fill:#096;}.cls-19{fill:#b36565;}.cls-20{fill:#5e5e5e;}.cls-21{fill:#2c78a3;}</style></defs><title/><g data-name="/ FLAT" id="_FLAT"><path class="cls-1" d="M280,328H240a32,32,0,0,0-32,32v88h40V368h32Z"/><path class="cls-2" d="M248,448V360a32,32,0,0,1,32-32h16a16,16,0,0,0,16-16V296h88v56a16,16,0,0,1-16,16H304a16,16,0,0,0-16,16v64Z"/><rect class="cls-3" height="64" width="40" x="248" y="384"/><rect class="cls-4" height="64" width="40" x="208" y="384"/><path class="cls-5" d="M188,448h68a0,0,0,0,1,0,0v20a20,20,0,0,1-20,20H188a20,20,0,0,1-20-20v0A20,20,0,0,1,188,448Z"/><path class="cls-5" d="M236,448a20,20,0,0,0,0,40h32a19.9999,19.9999,0,0,0,20-20V448Z"/><path class="cls-6" d="M248,488h20a19.9999,19.9999,0,0,0,20-20V448A40,40,0,0,1,248,488Z"/><path class="cls-5" d="M216,488h40V448A40,40,0,0,1,216,488Z"/><path class="cls-6" d="M216,488h20a19.9999,19.9999,0,0,0,20-20V448A40,40,0,0,1,216,488Z"/><path class="cls-7" d="M408,464H392V400H376v64H360a24.02718,24.02718,0,0,0-24,24v8h16v-8a8.00917,8.00917,0,0,1,8-8h16v16h16V480h16a8.00917,8.00917,0,0,1,8,8v8h16v-8A24.02718,24.02718,0,0,0,408,464Z"/><path class="cls-7" d="M296,264H240v32h72V280A16.00008,16.00008,0,0,0,296,264Z"/><path class="cls-4" d="M216,216v0a16,16,0,0,0,16,16h96V200H232A16,16,0,0,0,216,216Z"/><path class="cls-8" d="M419.27059,184.013C408.43279,184.39836,400,193.6347,400,204.47934V352a16,16,0,0,1-16,16H340a19.9999,19.9999,0,0,0-20,20h0a19.9999,19.9999,0,0,0,20,20h68a32,32,0,0,0,32-32V204A20.00054,20.00054,0,0,0,419.27059,184.013Z"/><path class="cls-3" d="M344,160v-5.16747a16,16,0,0,0-10.05775-14.85563l-9.82675-3.9307A32,32,0,0,1,304,106.33494V80h80v80Z"/><path class="cls-9" d="M352,160h-8l-22.62738,22.62738A32.00011,32.00011,0,0,0,312,205.25488V296h88V203.33126a48,48,0,0,0-5.06749-21.46625L384,160Z"/><rect class="cls-10" height="232" width="16" x="32" y="72"/><rect class="cls-10" height="16.00036" transform="translate(-33.13708 79.99512) rotate(-44.99753)" width="181.01934" x="-10.50967" y="71.99982"/><path class="cls-11" d="M120,40h26.74517a32,32,0,0,1,22.62741,9.37258L184,64l-40,40L129.37258,89.37258A32,32,0,0,1,120,66.74517Z"/><rect class="cls-11" height="45.25483" transform="translate(6.86292 96.56854) rotate(-45)" width="16.00036" x="111.99982" y="17.37258"/><rect class="cls-12" height="22.62742" transform="translate(-22.96046 168.56854) rotate(-45)" width="16.00036" x="183.99982" y="100.68629"/><rect class="cls-12" height="16" width="24" x="200" y="80"/><rect class="cls-12" height="24" width="16" x="160" y="120"/><path class="cls-3" d="M360,208v8a16.00008,16.00008,0,0,1-16,16H296a15.99993,15.99993,0,0,0-16,16h0a16.00008,16.00008,0,0,0,16,16h72a32,32,0,0,0,32-32V208Z"/><path class="cls-13" d="M344,40H304V80h80A40,40,0,0,0,344,40Z"/><path class="cls-7" d="M234.57251,188.86206A16.00016,16.00016,0,0,0,218.88306,176H107.51685a15.99991,15.99991,0,0,0-15.68921,19.1377L112,296H256Z"/><path class="cls-4" d="M384,80H368v32h16a16.00008,16.00008,0,0,0,16-16h0A15.99993,15.99993,0,0,0,384,80Z"/><circle class="cls-14" cx="168" cy="232" r="16"/><path class="cls-15" d="M248,448h40V408A40.0001,40.0001,0,0,1,248,448Z"/><path class="cls-16" d="M208,448h40V408A40.0001,40.0001,0,0,1,208,448Z"/><path class="cls-17" d="M144.00012,288H254.4l-11.77636-58.88208A111.9762,111.9762,0,0,1,144.00012,288Z"/><path class="cls-18" d="M344,288h56V232A56.00012,56.00012,0,0,1,344,288Z"/><path class="cls-15" d="M360,160h24V136A23.99994,23.99994,0,0,1,360,160Z"/><path class="cls-19" d="M344,80h40a39.79971,39.79971,0,0,0-5.36462-20A39.97379,39.97379,0,0,1,344,80Z"/><path class="cls-1" d="M336,368h48a16.00008,16.00008,0,0,0,16-16V304A64,64,0,0,1,336,368Z"/><path class="cls-20" d="M334.25659,407.15332A19.9884,19.9884,0,0,0,340,408h68a32.00018,32.00018,0,0,0,32-32V288A120.01371,120.01371,0,0,1,334.25659,407.15332Z"/><path class="cls-17" d="M376,408v16a16.00008,16.00008,0,0,1,16-16Z"/><polygon class="cls-10" points="496 288 16 288 16 304 32 304 32 496 48 496 48 304 464 304 464 496 480 496 480 304 496 304 496 288"/><path class="cls-15" d="M344,264h24a32,32,0,0,0,32-32V208A56,56,0,0,1,344,264Z"/><path class="cls-16" d="M280,232h32V200A32,32,0,0,1,280,232Z"/><path class="cls-21" d="M134.93359,94.93359,144,104l40-40-9.06641-9.06641A88.35924,88.35924,0,0,1,134.93359,94.93359Z"/><path class="cls-17" d="M288,288h24v-8a15.90919,15.90919,0,0,0-1.69629-7.13916A24.00215,24.00215,0,0,1,288,288Z"/></g></svg>
    <span style=" top: 45px; position: inherit;">Друзья</span>
  </div>
  <a href="https://vk.com/diff_games" target="_blank">
    <div class="leftIcon">
      <svg viewBox="0 0 22.577778 22.577778" class="imageMenuSection"> <defs id="defs825"> <pattern y="0" x="0" height="6" width="6" patternUnits="userSpaceOnUse" id="EMFhbasepattern" /> <pattern y="0" x="0" height="6" width="6" patternUnits="userSpaceOnUse" id="EMFhbasepattern-9" /> <pattern y="0" x="0" height="6" width="6" patternUnits="userSpaceOnUse" id="EMFhbasepattern-0" /> <pattern y="0" x="0" height="6" width="6" patternUnits="userSpaceOnUse" id="EMFhbasepattern-7" /> <pattern y="0" x="0" height="6" width="6" patternUnits="userSpaceOnUse" id="EMFhbasepattern-2" /> <pattern y="0" x="0" height="6" width="6" patternUnits="userSpaceOnUse" id="EMFhbasepattern-98" /> <pattern y="0" x="0" height="6" width="6" patternUnits="userSpaceOnUse" id="EMFhbasepattern-6" /> <pattern y="0" x="0" height="6" width="6" patternUnits="userSpaceOnUse" id="EMFhbasepattern-01" /> <pattern y="0" x="0" height="6" width="6" patternUnits="userSpaceOnUse" id="EMFhbasepattern-07" /> <pattern y="0" x="0" height="6" width="6" patternUnits="userSpaceOnUse" id="EMFhbasepattern-8" /> <pattern y="0" x="0" height="6" width="6" patternUnits="userSpaceOnUse" id="EMFhbasepattern-4" /> <pattern y="0" x="0" height="6" width="6" patternUnits="userSpaceOnUse" id="EMFhbasepattern-40" /> <pattern y="0" x="0" height="6" width="6" patternUnits="userSpaceOnUse" id="EMFhbasepattern-08" /> <pattern y="0" x="0" height="6" width="6" patternUnits="userSpaceOnUse" id="EMFhbasepattern-04" /> <pattern y="0" x="0" height="6" width="6" patternUnits="userSpaceOnUse" id="EMFhbasepattern-014" /> <pattern y="0" x="0" height="6" width="6" patternUnits="userSpaceOnUse" id="EMFhbasepattern-27" /> <pattern y="0" x="0" height="6" width="6" patternUnits="userSpaceOnUse" id="EMFhbasepattern-09" /> <pattern y="0" x="0" height="6" width="6" patternUnits="userSpaceOnUse" id="EMFhbasepattern-5" /> <pattern y="0" x="0" height="6" width="6" patternUnits="userSpaceOnUse" id="EMFhbasepattern-018" /> </defs> <sodipodi:namedview inkscape:document-rotation="0" inkscape:snap-global="true" inkscape:snap-nodes="false" inkscape:bbox-nodes="true" inkscape:snap-bbox="true" showguides="true" inkscape:snap-midpoints="true" inkscape:snap-smooth-nodes="true" inkscape:snap-intersection-paths="true" inkscape:object-paths="true" inkscape:showpageshadow="false" inkscape:pagecheckerboard="true" inkscape:window-maximized="1" inkscape:window-y="-8" inkscape:window-x="-8" inkscape:window-height="706" inkscape:window-width="1366" units="pt" showgrid="false" inkscape:current-layer="layer1" inkscape:document-units="pt" inkscape:cy="42.56527" inkscape:cx="42.682208" inkscape:zoom="4.2757863" inkscape:pageshadow="2" inkscape:pageopacity="0.0" borderopacity="1.0" bordercolor="#666666" pagecolor="#ffffff" id="base"> <inkscape:grid id="grid1378" type="xygrid" /> <sodipodi:guide inkscape:locked="false" id="guide1380" orientation="78.000048,0" position="0.97013831,21.607643" /> <sodipodi:guide inkscape:locked="false" id="guide1382" orientation="0,78.000005" position="0.97013831,0.97013129" /> <sodipodi:guide inkscape:locked="false" id="guide1384" orientation="-78.000048,0" position="21.607639,0.97013129" /> <sodipodi:guide inkscape:locked="false" id="guide1386" orientation="0,-78.000005" position="21.607639,21.607643" /> </sodipodi:namedview> <metadata id="metadata828"> <rdf:RDF> <cc:Work rdf:about=""> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /> <dc:title></dc:title> </cc:Work> </rdf:RDF> </metadata> <g transform="translate(0,-274.42223)" id="layer1" inkscape:groupmode="layer" inkscape:label="Icon"> <g style="stroke-width:0.794815" id="g35228" transform="matrix(1.2581542,0,0,1.2581542,-114.49582,-154.06306)"> <path style="color:#000000;clip-rule:evenodd;fill:#ea676c;fill-rule:evenodd;stroke-width:0.794815;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5" d="m 103.7181,348.92187 a 0.26460996,0.26460996 0 0 0 -0.0664,0.01 c -1.00458,0.25896 -1.70731,0.56402 -2.17188,1.03516 -0.46456,0.47113 -0.64843,1.09531 -0.64843,1.86718 v 0.65235 c 0,0.13929 0.0556,0.27439 0.15429,0.37304 0.0988,0.0988 0.23129,0.1543 0.3711,0.1543 h 6.29297 c 0.1398,0 0.27431,-0.0556 0.37304,-0.1543 0.0987,-0.0987 0.1543,-0.23375 0.1543,-0.37304 v -0.65235 c 0,-0.77187 -0.18387,-1.39605 -0.64844,-1.86718 -0.46456,-0.47114 -1.16729,-0.7762 -2.17187,-1.03516 a 0.26460996,0.26460996 0 0 0 -0.0664,-0.01 c -0.52441,10e-6 -1.04785,10e-6 -1.57226,0 z" id="path405811" /> <path style="color:#000000;clip-rule:evenodd;fill:#3a4d5c;fill-rule:evenodd;stroke-width:0.794815;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5" d="m 104.03255,345.2168 c -0.36576,-0.0348 -0.85641,0.12548 -1.21484,0.68554 -0.62079,0.97026 -0.58458,1.88177 -0.63282,2.38477 a 0.26460996,0.26460996 0 0 0 0,0.002 c -0.0215,0.23806 0.12728,0.46398 0.35742,0.53321 a 0.26460996,0.26460996 0 0 0 0.002,0 c 0.35908,0.1045 0.84552,0.0808 1.24219,0.0566 h 1.42773 c 0.39671,0.0242 0.88324,0.0477 1.24219,-0.0566 a 0.26460996,0.26460996 0 0 0 0.002,0 c 0.23015,-0.0692 0.37881,-0.29517 0.35742,-0.53321 a 0.26460996,0.26460996 0 0 0 0,-0.002 c -0.0482,-0.50304 -0.0121,-1.41452 -0.63281,-2.38477 -0.35844,-0.56006 -0.84909,-0.72037 -1.21484,-0.68554 -0.27416,0.0261 -0.37713,0.11581 -0.4668,0.17187 -0.0895,-0.056 -0.19434,-0.14574 -0.46875,-0.17187 z" id="path405917" /> <path style="color:#000000;clip-rule:evenodd;fill:#f8c09d;fill-rule:evenodd;stroke-width:0.794815;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5" d="m 103.55403,348.3125 -0.0996,0.9043 c -0.001,0.01 -0.002,0.0195 -0.002,0.0293 0,0.57723 0.47371,1.05078 1.05078,1.05078 0.57749,0 1.05274,-0.47328 1.05274,-1.05078 -1.2e-4,-0.01 -7.9e-4,-0.0196 -0.002,-0.0293 l -0.0976,-0.90235 c -0.63629,0.0819 -1.26594,0.0372 -1.90232,-0.002 z" id="path405925" sodipodi:nodetypes="cccscccc" /> <path id="path435676" style="color:#000000;clip-rule:evenodd;fill:#ef937e;fill-opacity:1;fill-rule:evenodd;stroke-width:0.794815;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5" d="m 103.55389,348.31263 -0.0641,0.58652 c 0.0322,0.0453 0.0666,0.088 0.10335,0.12816 0.2365,0.25816 0.5654,0.39843 0.90796,0.39843 0.34256,0 0.67197,-0.14027 0.90847,-0.39843 0.0389,-0.0425 0.0752,-0.0877 0.10904,-0.13591 l -0.0625,-0.57671 c -0.63629,0.0819 -1.26583,0.0371 -1.90221,-0.002 z" /> <path style="color:#000000;clip-rule:evenodd;fill:#f8c09d;fill-rule:evenodd;stroke-width:0.794815;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5" d="m 103.47786,346.57812 a 0.26460996,0.26460996 0 0 0 -0.16797,0.1504 c -0.0841,0.199 -0.1289,0.4289 -0.1289,0.68359 a 0.26460996,0.26460996 0 0 0 0,0.0176 c 0.0314,0.444 0.1756,0.81019 0.41211,1.06836 0.2365,0.25816 0.56564,0.39843 0.9082,0.39843 0.34256,0 0.6717,-0.14027 0.9082,-0.39843 0.2365,-0.25817 0.38073,-0.62436 0.41211,-1.06836 a 0.26460996,0.26460996 0 0 0 -0.26367,-0.28321 c -0.30684,-5.1e-4 -0.57628,-0.16452 -0.70508,-0.43164 a 0.26460996,0.26460996 0 0 0 -0.36914,-0.11328 c -0.44812,0.25872 -0.7832,0.01 -0.7832,0.01 a 0.26460996,0.26460996 0 0 0 -0.22266,-0.0332 z" id="path405933" /> <path id="path405989" style="color:#000000;clip-rule:evenodd;fill:#1d2c39;fill-rule:evenodd;stroke-width:3.00403;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5" d="m 390.43359,251.81445 c 0.26964,-0.48466 0.8822,-0.65729 1.36524,-0.38476 0.4512,0.25047 0.95672,0.38454 1.47656,0.38476 0.9069,-6e-4 1.72623,-0.39572 2.28125,-1.02539 0.17443,-0.19968 0.42102,-0.32194 0.68555,-0.33984 h -10e-6 c 0.26516,-0.0162 0.52587,0.0737 0.72461,0.25 0.41318,0.36538 0.45251,0.9963 0.0879,1.41016 -0.10219,0.11592 -0.20986,0.22615 -0.32227,0.33203 0.60954,0.63914 1.36848,0.99149 2.2375,1.08789 0.81325,0.0235 0.9981,0.45141 0.9961,1.0039 -0.009,0.38626 -0.0575,0.75555 -0.12973,1.11466 -2.32135,0 -3.89666,-1.03054 -4.95978,-2.09366 -0.50563,0.16915 -1.04501,0.25988 -1.60112,0.26025 -0.85791,-3.7e-4 -1.70162,-0.21856 -2.45117,-0.63476 -0.0918,-0.0505 -0.67918,-0.34432 -0.67918,-0.34432 0.0436,-0.35619 0.15519,-0.69185 0.28855,-1.02092 z" transform="matrix(0.26458334,0,0,0.26458334,0,280.06666)" sodipodi:nodetypes="cccccccccsscccccc" /> <path id="path65188" style="color:#000000;clip-rule:evenodd;fill:#ea4343;fill-rule:evenodd;stroke-width:0.794815;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5" d="m 107.53039,349.96834 c -0.0578,0.006 -0.1086,0.019 -0.15813,0.0336 h -0.002 c -0.002,2.6e-4 -0.5127,0.12758 -0.83199,0.62321 a 0.2645835,0.2645835 0 0 0 0.0801,0.36536 0.2645835,0.2645835 0 0 0 0.36536,-0.0786 c 0.2049,-0.31807 0.51779,-0.39843 0.51779,-0.39843 a 0.26460996,0.26460996 0 0 0 0.0114,-0.002 c 0.0147,-0.004 0.10857,-0.0118 0.0997,-0.0134 a 0.2645835,0.2645835 0 0 0 0.24598,-0.092 c -0.0886,-0.15791 -0.19679,-0.30421 -0.32815,-0.4377 z m -1.32033,1.46709 a 0.2645835,0.2645835 0 0 0 -0.26562,0.26355 v 1.31517 h 0.52969 v -1.31517 a 0.2645835,0.2645835 0 0 0 -0.26407,-0.26355 z" /> <g style="stroke-width:0.794815" id="g450772"> <path style="color:#000000;clip-rule:evenodd;fill:#6acce2;fill-rule:evenodd;stroke-width:0.794815;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5" d="m 94.658854,348.92187 a 0.26460996,0.26460996 0 0 0 -0.06445,0.01 c -1.004582,0.25896 -1.707309,0.56402 -2.171875,1.03516 -0.464565,0.47113 -0.648437,1.09531 -0.648437,1.86718 v 0.65235 c 0,0.13924 0.05368,0.27436 0.152344,0.37304 0.09874,0.0988 0.233244,0.1543 0.373046,0.1543 h 6.292969 c 0.139803,0 0.274305,-0.0555 0.373047,-0.1543 0.0987,-0.0987 0.154297,-0.2338 0.154297,-0.37304 v -0.65235 c 0,-0.77187 -0.183872,-1.39605 -0.648438,-1.86718 -0.464565,-0.47114 -1.167292,-0.7762 -2.171875,-1.03516 a 0.26460996,0.26460996 0 0 0 -0.06641,-0.01 c -0.524412,10e-6 -1.049806,10e-6 -1.574218,0 z" id="path405819" /> <path id="path443647" style="color:#000000;clip-rule:evenodd;fill:#28a7bd;fill-opacity:1;fill-rule:evenodd;stroke-width:3.00403;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5" d="m 371.74219,263.7793 c -2.89426,0.92164 -5.26234,2.0989 -7.0918,3.95312 -2.1125,2.14108 -3.04769,4.98272 -3.21289,7.97461 h 11.19531 c 0.52839,0 1.03696,-0.21057 1.41016,-0.58398 0.37304,-0.37304 0.58398,-0.8839 0.58398,-1.41016 v -2.46484 c 0,-2.91731 -0.69533,-5.27795 -2.45117,-7.0586 -0.13876,-0.14073 -0.28347,-0.27704 -0.43359,-0.41015 z" transform="matrix(0.26458334,0,0,0.26458334,0,280.06666)" /> <path style="color:#000000;clip-rule:evenodd;fill:#f8c09d;fill-rule:evenodd;stroke-width:0.794815;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5" d="m 94.756511,348.07227 a 0.26460996,0.26460996 0 0 0 -0.261719,0.23632 l -0.09766,0.90821 a 0.26460996,0.26460996 0 0 0 -0.002,0.0293 c 0,0.5775 0.473291,1.05079 1.050781,1.05078 h 0.002 c 0.577069,0 1.048828,-0.47354 1.048828,-1.05078 a 0.26460996,0.26460996 0 0 0 0,-0.0293 l -0.09961,-0.91016 a 0.26460996,0.26460996 0 0 0 -0.263672,-0.23437 z" id="path405869" /> <path id="path419217" style="color:#000000;clip-rule:evenodd;fill:#ef937e;fill-opacity:1;fill-rule:evenodd;stroke-width:0.794815;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5" d="m 94.756494,348.07233 a 0.26460996,0.26460996 0 0 0 -0.261486,0.23616 l -0.06459,0.60306 c 0.267867,0.28797 0.624202,0.47491 1.019577,0.47491 0.39198,0 0.747525,-0.18246 1.014407,-0.46509 l -0.06718,-0.61495 a 0.26460996,0.26460996 0 0 0 -0.263552,-0.23409 z" /> <path style="color:#000000;clip-rule:evenodd;fill:#f8c09d;fill-rule:evenodd;stroke-width:0.794815;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5" d="m 95.471354,345.42578 a 0.26460996,0.26460996 0 0 0 -0.289062,0.0176 c 0,0 -0.291002,0.21637 -0.585938,0.44141 -0.147467,0.11251 -0.295213,0.22584 -0.410156,0.31835 -0.05747,0.0463 -0.107248,0.0864 -0.146484,0.1211 -0.01962,0.0174 -0.03691,0.0344 -0.05469,0.0527 -0.0089,0.009 -0.01726,0.0177 -0.0293,0.0332 -0.006,0.008 -0.01296,0.017 -0.02148,0.0312 -0.0043,0.007 -0.0086,0.0163 -0.01367,0.0273 -0.0051,0.011 -0.01549,0.0425 -0.01563,0.043 a 0.26460996,0.26460996 0 0 0 -0.0078,0.0312 c -0.01462,0.10103 -0.02344,0.18796 -0.02344,0.30664 0,0.53514 0.161104,1.02334 0.4375,1.39062 0.276397,0.36729 0.681372,0.61719 1.138672,0.61719 0.426993,0 0.811018,-0.21629 1.083984,-0.54297 0.272967,-0.32667 0.445667,-0.7656 0.484375,-1.2539 l -0.002,0.0254 0.09375,-0.52344 a 0.26460996,0.26460996 0 0 0 -0.130818,-0.27722 z" id="path405877" /> <path style="color:#000000;clip-rule:evenodd;fill:#3a4d5c;fill-rule:evenodd;stroke-width:0.794815;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5" d="m 95.457683,344.62891 c -0.581792,-0.0486 -1.142745,0.20438 -1.523438,0.56054 -0.190346,0.17808 -0.337287,0.38541 -0.408203,0.61914 -0.07092,0.23374 -0.04952,0.50686 0.107422,0.72461 0.164179,0.22793 0.427398,0.32065 0.671875,0.33789 0.244477,0.0173 0.492076,-0.0276 0.71875,-0.0879 0.355837,-0.0946 0.537912,-0.19153 0.65625,-0.24804 0.153529,0.16817 0.421508,0.46374 0.753906,0.65234 0.183751,0.10426 0.413853,0.20034 0.654297,0.0762 0.120222,-0.0621 0.207274,-0.17757 0.253906,-0.30273 0.04663,-0.12517 0.06445,-0.26526 0.06445,-0.4336 0,-0.71528 -0.203445,-1.20983 -0.578125,-1.49804 -0.374679,-0.28822 -0.853276,-0.35723 -1.371093,-0.40039 z" id="path405885" /> <path style="color:#000000;clip-rule:evenodd;fill:#1d2c39;fill-rule:evenodd;stroke-width:0.794815;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5" d="m 96.272136,345.60547 a 0.2645835,0.2645835 0 0 0 -0.185547,0.0801 c -0.105422,0.10692 -0.466797,0.31054 -0.466797,0.31054 a 0.2645835,0.2645835 0 0 0 -0.113281,0.35547 0.2645835,0.2645835 0 0 0 0.355468,0.11328 c 0,0 0.366537,-0.16982 0.601563,-0.4082 a 0.2645835,0.2645835 0 0 0 -0.0039,-0.375 0.2645835,0.2645835 0 0 0 -0.1875,-0.0762 z" id="path57779" /> <path id="path60649" style="color:#000000;clip-rule:evenodd;fill:#28a7bd;fill-rule:evenodd;stroke-width:0.794815;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5" d="m 92.421233,349.96886 c -0.131246,0.13342 -0.240146,0.27937 -0.32866,0.43718 a 0.2645835,0.2645835 0 0 0 0.245978,0.092 c -0.0088,0.002 0.08286,0.009 0.09767,0.014 a 0.26460996,0.26460996 0 0 0 0.01344,0.002 c 0,0 0.312902,0.0804 0.517798,0.39843 a 0.2645835,0.2645835 0 0 0 0.365352,0.0785 0.2645835,0.2645835 0 0 0 0.07803,-0.36536 c -0.318923,-0.49507 -0.827233,-0.62048 -0.829924,-0.62115 -5.29e-4,-1.8e-4 -0.0016,-0.002 -0.0021,-0.002 -0.04946,-0.0148 -0.100254,-0.0276 -0.157615,-0.0331 z m 1.319819,1.46657 a 0.2645835,0.2645835 0 0 0 -0.265618,0.26355 v 1.31517 h 0.529167 v -1.31517 a 0.2645835,0.2645835 0 0 0 -0.263549,-0.26355 z" /> <path style="color:#000000;clip-rule:evenodd;fill:#1d2c39;fill-rule:evenodd;stroke-width:0.794815;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5" d="m 95.621745,345.99414 c 0,0 -0.348236,0.17473 -0.734375,0.27734 -0.193069,0.0513 -0.394256,0.0829 -0.544922,0.0723 -0.150665,-0.0106 -0.22925,-0.0497 -0.279297,-0.11914 a 0.2645835,0.2645835 0 0 0 -0.36914,-0.0605 0.2645835,0.2645835 0 0 0 -0.06055,0.36914 c 0.164179,0.22793 0.427398,0.32065 0.671875,0.33789 0.244477,0.0173 0.492076,-0.0276 0.71875,-0.0879 0.453347,-0.12047 0.835937,-0.3164 0.835937,-0.3164 a 0.2645835,0.2645835 0 0 0 0.117188,-0.35547 0.2645835,0.2645835 0 0 0 -0.355469,-0.11719 z" id="path405959" /> </g> <path id="path445994" style="color:#000000;clip-rule:evenodd;fill:#ea4343;fill-opacity:1;fill-rule:evenodd;stroke-width:3.00403;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5" d="m 384.05859,263.71094 c -0.17836,0.15459 -0.35095,0.3135 -0.51367,0.47851 -1.75582,1.78065 -2.44922,4.14129 -2.44922,7.0586 v 2.46484 c 0,0.52645 0.20903,1.03731 0.58203,1.41016 0.37342,0.37341 0.87393,0.58398 1.40235,0.58398 h 11.49219 c -0.16393,-2.98765 -1.09378,-5.82349 -3.20704,-7.9668 -1.8743,-1.90093 -4.30992,-3.0951 -7.30664,-4.02929 z" transform="matrix(0.26458334,0,0,0.26458334,0,280.06666)" /> <path style="color:#000000;clip-rule:evenodd;fill:#ffbb41;fill-rule:evenodd;stroke-width:0.794815;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5" d="m 99.226562,350.36523 a 0.26460996,0.26460996 0 0 0 -0.06445,0.008 c -1.003164,0.2586 -1.707005,0.56399 -2.171875,1.03515 -0.46487,0.47116 -0.65039,1.09698 -0.65039,1.86914 0,0.2284 0.0015,0.43603 0.002,0.65235 4.79e-4,0.2873 0.239802,0.52539 0.527344,0.52539 h 6.291019 c 0.13929,0 0.27437,-0.0556 0.37304,-0.1543 0.0989,-0.0988 0.1543,-0.23129 0.1543,-0.37109 v -0.65235 c 0,-0.77198 -0.18387,-1.39797 -0.64844,-1.86914 -0.46456,-0.47116 -1.16729,-0.7762 -2.17187,-1.03515 a 0.26460996,0.26460996 0 0 0 -0.0664,-0.008 z" id="path405833" /> <path style="color:#000000;clip-rule:evenodd;fill:#f8c09d;fill-rule:evenodd;stroke-width:0.794815;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5" d="m 99.349609,349.25 a 0.26460996,0.26460996 0 0 0 -0.263672,0.23828 l -0.121093,1.17383 a 0.26460996,0.26460996 0 0 0 -0.002,0.0273 c 0,0.57707 0.473548,1.04883 1.050776,1.04883 0.57749,0 1.05274,-0.47345 1.05274,-1.05078 a 0.26460996,0.26460996 0 0 0 -0.002,-0.0254 l -0.12109,-1.17383 A 0.26460996,0.26460996 0 0 0 100.68164,349.25 Z" id="path405841" /> <path id="path57743" style="color:#000000;clip-rule:evenodd;fill:#ec7523;fill-rule:evenodd;stroke-width:0.794815;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5" d="m 103.04333,351.4127 c -0.0602,0.006 -0.11315,0.0192 -0.16434,0.0346 -0.005,0.001 -0.51184,0.1253 -0.82992,0.61908 a 0.2645835,0.2645835 0 0 0 0.0801,0.36742 0.2645835,0.2645835 0 0 0 0.36484,-0.0801 c 0.20489,-0.31808 0.51779,-0.39687 0.51779,-0.39687 a 0.26460996,0.26460996 0 0 0 0.0119,-0.004 c 0.0147,-0.004 0.10805,-0.0104 0.0992,-0.0119 a 0.2645835,0.2645835 0 0 0 0.2465,-0.0941 c -0.088,-0.15695 -0.19597,-0.30191 -0.32608,-0.43459 z m -6.057515,5.2e-4 c -0.130966,0.13356 -0.239708,0.27959 -0.328147,0.4377 a 0.2645835,0.2645835 0 0 0 0.242879,0.0904 c -0.0088,0.002 0.08441,0.007 0.09922,0.0119 a 0.26460996,0.26460996 0 0 0 0.01188,0.004 c 0,0 0.312904,0.0783 0.517797,0.39636 a 0.2645835,0.2645835 0 0 0 0.364837,0.0801 0.2645835,0.2645835 0 0 0 0.0801,-0.36742 c -0.318087,-0.49379 -0.824577,-0.61775 -0.829924,-0.61908 -0.04953,-0.0149 -0.100772,-0.0281 -0.158647,-0.0341 z m 1.324983,1.464 a 0.2645835,0.2645835 0 0 0 -0.264068,0.26561 v 1.31259 h 0.529686 v -1.31259 a 0.2645835,0.2645835 0 0 0 -0.265618,-0.26561 z m 3.410132,0 a 0.2645835,0.2645835 0 0 0 -0.26562,0.26561 v 1.31259 h 0.52916 v -1.31259 a 0.2645835,0.2645835 0 0 0 -0.26354,-0.26561 z" /> <path id="path430869" style="color:#000000;clip-rule:evenodd;fill:#ef937e;fill-opacity:1;fill-rule:evenodd;stroke-width:0.794815;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5" d="m 99.349494,349.25004 a 0.26460996,0.26460996 0 0 0 -0.263549,0.23822 l -0.06408,0.62167 c 0.268616,0.25801 0.613918,0.41548 0.999425,0.41548 0.37901,0 0.72007,-0.15289 0.98702,-0.40359 l -0.0651,-0.63356 a 0.26460996,0.26460996 0 0 0 -0.26149,-0.23822 z" /> <path style="color:#000000;clip-rule:evenodd;fill:#f8c09d;fill-rule:evenodd;stroke-width:0.794815;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5" d="m 100.42578,346.5625 -1.521483,0.19336 A 0.26460996,0.26460996 0 0 0 98.6875,346.9375 l -0.230469,0.71484 a 0.26460996,0.26460996 0 0 0 -0.01172,0.0801 v 0.42578 c 0,0.98771 0.680183,1.83789 1.576169,1.83789 0.8381,0 1.48942,-0.74679 1.56836,-1.64843 a 0.26460996,0.26460996 0 0 0 0.002,-0.0234 V 347.5 a 0.26460996,0.26460996 0 0 0 -0.10157,-0.20898 l -0.86718,-0.67579 a 0.26460996,0.26460996 0 0 0 -0.19727,-0.0527 z" id="path405861" /> <path style="color:#000000;clip-rule:evenodd;fill:#3a4d5c;fill-rule:evenodd;stroke-width:0.794815;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5" d="m 100.0293,345.78711 c -0.581794,-0.0486 -1.142747,0.20438 -1.523441,0.56055 -0.190346,0.17808 -0.33924,0.3854 -0.410156,0.61914 -0.07092,0.23373 -0.04757,0.50685 0.109375,0.72461 0.16418,0.22793 0.427398,0.32064 0.671875,0.33789 0.244478,0.0172 0.490123,-0.0277 0.716797,-0.0879 0.358235,-0.0952 0.54563,-0.19426 0.66211,-0.25 0.0987,0.11247 0.28776,0.34173 0.60937,0.56445 0.198,0.13711 0.41379,0.28055 0.69727,0.20508 0.14174,-0.0377 0.26945,-0.15631 0.33203,-0.29297 0.0626,-0.13667 0.084,-0.29213 0.084,-0.48242 0,-0.71528 -0.20345,-1.20983 -0.57813,-1.49805 -0.37468,-0.28822 -0.85328,-0.35722 -1.37109,-0.40039 z" id="path405967" /> <path style="color:#000000;clip-rule:evenodd;fill:#1d2c39;fill-rule:evenodd;stroke-width:0.794815;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5" d="m 100.37695,347.04687 c -0.10357,0.0633 -0.18554,0.10743 -0.18554,0.10743 a 0.2645835,0.2645835 0 0 0 -0.11328,0.35547 0.2645835,0.2645835 0 0 0 0.35546,0.11328 c 0,0 0.0983,-0.0495 0.21875,-0.12305 a 0.2645835,0.2645835 0 0 0 0.0879,-0.36523 0.2645835,0.2645835 0 0 0 -0.36328,-0.0879 z" id="path59832" /> <path style="color:#000000;clip-rule:evenodd;fill:#1d2c39;fill-rule:evenodd;stroke-width:0.794815;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5" d="m 100.19336,347.15234 c 0,0 -0.348235,0.17473 -0.734376,0.27735 -0.19307,0.0513 -0.394256,0.0829 -0.544922,0.0723 -0.150665,-0.0106 -0.22925,-0.0497 -0.279296,-0.11914 a 0.2645835,0.2645835 0 0 0 -0.369141,-0.0605 0.2645835,0.2645835 0 0 0 -0.06055,0.36914 c 0.16418,0.22793 0.427398,0.32064 0.671875,0.33789 0.244478,0.0172 0.490123,-0.0277 0.716797,-0.0879 0.453353,-0.12048 0.837893,-0.31641 0.837893,-0.31641 a 0.2645835,0.2645835 0 0 0 0.11719,-0.35547 0.2645835,0.2645835 0 0 0 -0.35547,-0.11719 z" id="path405981" /> </g> </g> </svg>
      <span style=" top: 40px; position: inherit; ">Группа</span>
    </div>
  </a>
</div>
<div id="user" style="position: fixed;top: 15px;left: 10px;font-family: 'Press Start 2P', cursive;line-height: 30px"></div>

<!-- partial -->
<script src='https://itchief.ru/assets/js/jquery-3.6.0.min.js'></script>
<script src="https://vk.com/js/api/xd_connection.js?2"></script>
<script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/three.js/r126/three.min.js'></script>
  <script>
window.focus(); // Capture keys right away (by default focus is on editor)
vkBridge.send("VKWebAppInit");
var music = new Audio ('https://raw.githubusercontent.com/Mashanov/race/main/race.mp3');
music.loop = true;
music.volume = 0.5;

vkBridge.send("VKWebAppGetUserInfo").then(function (data){

  $('#user').html(data.first_name + ' ' + data.last_name + '<br>Ваш рекорд: 0');
})

window.onfocus = function (){music.play ()}
window.onblur = function(){music.pause ()}

function aud ()
{

    if (document.querySelector('#musicStop').getAttribute('style') == null)
    {
        document.querySelector('#musicStop').style.display = 'block';
        music.volume = 0;

    } else {
        
        document.querySelector('#musicStop').removeAttribute('style');
        music.volume = 0.5;
    }
}

// Pick a random value from an array
function pickRandom(array) {
  return array[Math.floor(Math.random() * array.length)];
}

// The Pythagorean theorem says that the distance between two points is
// the square root of the sum of the horizontal and vertical distance's square
function getDistance(coordinate1, coordinate2) {
  const horizontalDistance = coordinate2.x - coordinate1.x;
  const verticalDistance = coordinate2.y - coordinate1.y;
  return Math.sqrt(horizontalDistance ** 2 + verticalDistance ** 2);
}

const vehicleColors = [
  0xa52523,
  0xef2d56,
  0x0ad3ff,
  0xff9f1c /*0xa52523, 0xbdb638, 0x78b14b*/
];

const lawnGreen = "#67C240";
const trackColor = "#546E90";
const edgeColor = "#725F48";
const treeCrownColor = 0x498c2c;
const treeTrunkColor = 0x4b3f2f;

const wheelGeometry = new THREE.BoxBufferGeometry(12, 33, 12);
const wheelMaterial = new THREE.MeshLambertMaterial({ color: 0x333333 });
const treeTrunkGeometry = new THREE.BoxBufferGeometry(15, 15, 30);
const treeTrunkMaterial = new THREE.MeshLambertMaterial({
  color: treeTrunkColor
});
const treeCrownMaterial = new THREE.MeshLambertMaterial({
  color: treeCrownColor
});

const config = {
  showHitZones: false,
  shadows: true, // Use shadow
  trees: true, // Add trees to the map
  curbs: true, // Show texture on the extruded geometry
  grid: false // Show grid helper
};

let score;
const speed = 0.0017;

const playerAngleInitial = Math.PI;
let playerAngleMoved;
let accelerate = false; // Is the player accelerating
let decelerate = false; // Is the player decelerating

let otherVehicles = [];
let ready;
let lastTimestamp;

const trackRadius = 225;
const trackWidth = 45;
const innerTrackRadius = trackRadius - trackWidth;
const outerTrackRadius = trackRadius + trackWidth;

const arcAngle1 = (1 / 3) * Math.PI; // 60 degrees

const deltaY = Math.sin(arcAngle1) * innerTrackRadius;
const arcAngle2 = Math.asin(deltaY / outerTrackRadius);

const arcCenterX =
  (Math.cos(arcAngle1) * innerTrackRadius +
    Math.cos(arcAngle2) * outerTrackRadius) /
  2;

const arcAngle3 = Math.acos(arcCenterX / innerTrackRadius);

const arcAngle4 = Math.acos(arcCenterX / outerTrackRadius);

const scoreElement = document.getElementById("score");
const buttonsElement = document.getElementById("buttons");
const resultsElement = document.getElementById("results");
const accelerateButton = document.getElementById("accelerate");
const decelerateButton = document.getElementById("decelerate");

setTimeout(() => {
  buttonsElement.style.opacity = 1;
}, 4000);

// Initialize ThreeJs
// Set up camera
const aspectRatio = window.innerWidth / window.innerHeight;
const cameraWidth = 960;
const cameraHeight = cameraWidth / aspectRatio;

const camera = new THREE.OrthographicCamera(
  cameraWidth / -2, // left
  cameraWidth / 2, // right
  cameraHeight / 2, // top
  cameraHeight / -2, // bottom
  50, // near plane
  700 // far plane
);

camera.position.set(0, -210, 300);
camera.lookAt(0, 0, 0);

const scene = new THREE.Scene();

const playerCar = Car();
scene.add(playerCar);

renderMap(cameraWidth, cameraHeight * 2); // The map height is higher because we look at the map from an angle

// Set up lights
const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
scene.add(ambientLight);

const dirLight = new THREE.DirectionalLight(0xffffff, 0.6);
dirLight.position.set(100, -300, 300);
dirLight.castShadow = true;
dirLight.shadow.mapSize.width = 1024;
dirLight.shadow.mapSize.height = 1024;
dirLight.shadow.camera.left = -400;
dirLight.shadow.camera.right = 350;
dirLight.shadow.camera.top = 400;
dirLight.shadow.camera.bottom = -300;
dirLight.shadow.camera.near = 100;
dirLight.shadow.camera.far = 800;
scene.add(dirLight);

// const cameraHelper = new THREE.CameraHelper(dirLight.shadow.camera);
// scene.add(cameraHelper);

if (config.grid) {
  const gridHelper = new THREE.GridHelper(80, 8);
  gridHelper.rotation.x = Math.PI / 2;
  scene.add(gridHelper);
}

// Set up renderer
const renderer = new THREE.WebGLRenderer({
  antialias: true,
  powerPreference: "high-performance"
});
renderer.setSize(window.innerWidth, window.innerHeight);
if (config.shadows) renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

reset();

function reset() {
  // Reset position and score
  playerAngleMoved = 0;
  score = 0;
  scoreElement.innerText = "Погнали";

  // Remove other vehicles
  otherVehicles.forEach((vehicle) => {
    // Remove the vehicle from the scene
    scene.remove(vehicle.mesh);

    // If it has hit-zone helpers then remove them as well
    if (vehicle.mesh.userData.hitZone1)
      scene.remove(vehicle.mesh.userData.hitZone1);
    if (vehicle.mesh.userData.hitZone2)
      scene.remove(vehicle.mesh.userData.hitZone2);
    if (vehicle.mesh.userData.hitZone3)
      scene.remove(vehicle.mesh.userData.hitZone3);
  });
  otherVehicles = [];

  resultsElement.style.display = "none";

  lastTimestamp = undefined;

  // Place the player's car to the starting position
  movePlayerCar(0);

  // Render the scene
  renderer.render(scene, camera);

  ready = true;
}

function startGame() {
  if (ready) {
    ready = false;
    scoreElement.innerText = 0;
    renderer.setAnimationLoop(animation);
  }
}
    
 buttonsElement.style.opacity = 1;

function positionScoreElement() {
  const arcCenterXinPixels = (arcCenterX / cameraWidth) * window.innerWidth;
  scoreElement.style.cssText = `
    left: ${window.innerWidth / 2 - arcCenterXinPixels * 1.3}px;
    top: ${window.innerHeight / 2}px
  `;
}

function getLineMarkings(mapWidth, mapHeight) {
  const canvas = document.createElement("canvas");
  canvas.width = mapWidth;
  canvas.height = mapHeight;
  const context = canvas.getContext("2d");

  context.fillStyle = trackColor;
  context.fillRect(0, 0, mapWidth, mapHeight);

  context.lineWidth = 2;
  context.strokeStyle = "#E0FFFF";
  context.setLineDash([10, 14]);

  // Left circle
  context.beginPath();
  context.arc(
    mapWidth / 2 - arcCenterX,
    mapHeight / 2,
    trackRadius,
    0,
    Math.PI * 2
  );
  context.stroke();

  // Right circle
  context.beginPath();
  context.arc(
    mapWidth / 2 + arcCenterX,
    mapHeight / 2,
    trackRadius,
    0,
    Math.PI * 2
  );
  context.stroke();

  return new THREE.CanvasTexture(canvas);
}

function getCurbsTexture(mapWidth, mapHeight) {
  const canvas = document.createElement("canvas");
  canvas.width = mapWidth;
  canvas.height = mapHeight;
  const context = canvas.getContext("2d");

  context.fillStyle = lawnGreen;
  context.fillRect(0, 0, mapWidth, mapHeight);

  // Extra big
  context.lineWidth = 65;
  context.strokeStyle = "#A2FF75";
  context.beginPath();
  context.arc(
    mapWidth / 2 - arcCenterX,
    mapHeight / 2,
    innerTrackRadius,
    arcAngle1,
    -arcAngle1
  );
  context.arc(
    mapWidth / 2 + arcCenterX,
    mapHeight / 2,
    outerTrackRadius,
    Math.PI + arcAngle2,
    Math.PI - arcAngle2,
    true
  );
  context.stroke();

  context.beginPath();
  context.arc(
    mapWidth / 2 + arcCenterX,
    mapHeight / 2,
    innerTrackRadius,
    Math.PI + arcAngle1,
    Math.PI - arcAngle1
  );
  context.arc(
    mapWidth / 2 - arcCenterX,
    mapHeight / 2,
    outerTrackRadius,
    arcAngle2,
    -arcAngle2,
    true
  );
  context.stroke();

  // Extra small
  context.lineWidth = 60;
  context.strokeStyle = lawnGreen;
  context.beginPath();
  context.arc(
    mapWidth / 2 - arcCenterX,
    mapHeight / 2,
    innerTrackRadius,
    arcAngle1,
    -arcAngle1
  );
  context.arc(
    mapWidth / 2 + arcCenterX,
    mapHeight / 2,
    outerTrackRadius,
    Math.PI + arcAngle2,
    Math.PI - arcAngle2,
    true
  );
  context.arc(
    mapWidth / 2 + arcCenterX,
    mapHeight / 2,
    innerTrackRadius,
    Math.PI + arcAngle1,
    Math.PI - arcAngle1
  );
  context.arc(
    mapWidth / 2 - arcCenterX,
    mapHeight / 2,
    outerTrackRadius,
    arcAngle2,
    -arcAngle2,
    true
  );
  context.stroke();

  // Base
  context.lineWidth = 6;
  context.strokeStyle = edgeColor;

  // Outer circle left
  context.beginPath();
  context.arc(
    mapWidth / 2 - arcCenterX,
    mapHeight / 2,
    outerTrackRadius,
    0,
    Math.PI * 2
  );
  context.stroke();

  // Outer circle right
  context.beginPath();
  context.arc(
    mapWidth / 2 + arcCenterX,
    mapHeight / 2,
    outerTrackRadius,
    0,
    Math.PI * 2
  );
  context.stroke();

  // Inner circle left
  context.beginPath();
  context.arc(
    mapWidth / 2 - arcCenterX,
    mapHeight / 2,
    innerTrackRadius,
    0,
    Math.PI * 2
  );
  context.stroke();

  // Inner circle right
  context.beginPath();
  context.arc(
    mapWidth / 2 + arcCenterX,
    mapHeight / 2,
    innerTrackRadius,
    0,
    Math.PI * 2
  );
  context.stroke();

  return new THREE.CanvasTexture(canvas);
}

function getLeftIsland() {
  const islandLeft = new THREE.Shape();

  islandLeft.absarc(
    -arcCenterX,
    0,
    innerTrackRadius,
    arcAngle1,
    -arcAngle1,
    false
  );

  islandLeft.absarc(
    arcCenterX,
    0,
    outerTrackRadius,
    Math.PI + arcAngle2,
    Math.PI - arcAngle2,
    true
  );

  return islandLeft;
}

function getMiddleIsland() {
  const islandMiddle = new THREE.Shape();

  islandMiddle.absarc(
    -arcCenterX,
    0,
    innerTrackRadius,
    arcAngle3,
    -arcAngle3,
    true
  );

  islandMiddle.absarc(
    arcCenterX,
    0,
    innerTrackRadius,
    Math.PI + arcAngle3,
    Math.PI - arcAngle3,
    true
  );

  return islandMiddle;
}

function getRightIsland() {
  const islandRight = new THREE.Shape();

  islandRight.absarc(
    arcCenterX,
    0,
    innerTrackRadius,
    Math.PI - arcAngle1,
    Math.PI + arcAngle1,
    true
  );

  islandRight.absarc(
    -arcCenterX,
    0,
    outerTrackRadius,
    -arcAngle2,
    arcAngle2,
    false
  );

  return islandRight;
}

function getOuterField(mapWidth, mapHeight) {
  const field = new THREE.Shape();

  field.moveTo(-mapWidth / 2, -mapHeight / 2);
  field.lineTo(0, -mapHeight / 2);

  field.absarc(-arcCenterX, 0, outerTrackRadius, -arcAngle4, arcAngle4, true);

  field.absarc(
    arcCenterX,
    0,
    outerTrackRadius,
    Math.PI - arcAngle4,
    Math.PI + arcAngle4,
    true
  );

  field.lineTo(0, -mapHeight / 2);
  field.lineTo(mapWidth / 2, -mapHeight / 2);
  field.lineTo(mapWidth / 2, mapHeight / 2);
  field.lineTo(-mapWidth / 2, mapHeight / 2);

  return field;
}

function renderMap(mapWidth, mapHeight) {
  const lineMarkingsTexture = getLineMarkings(mapWidth, mapHeight);

  const planeGeometry = new THREE.PlaneBufferGeometry(mapWidth, mapHeight);
  const planeMaterial = new THREE.MeshLambertMaterial({
    map: lineMarkingsTexture
  });
  const plane = new THREE.Mesh(planeGeometry, planeMaterial);
  plane.receiveShadow = true;
  plane.matrixAutoUpdate = false;
  scene.add(plane);

  // Extruded geometry with curbs
  const islandLeft = getLeftIsland();
  const islandMiddle = getMiddleIsland();
  const islandRight = getRightIsland();
  const outerField = getOuterField(mapWidth, mapHeight);

  // Mapping a texture on an extruded geometry works differently than mapping it to a box
  // By default it is mapped to a 1x1 unit square, and we have to stretch it out by setting repeat
  // We also need to shift it by setting the offset to have it centered
  const curbsTexture = getCurbsTexture(mapWidth, mapHeight);
  curbsTexture.offset = new THREE.Vector2(0.5, 0.5);
  curbsTexture.repeat.set(1 / mapWidth, 1 / mapHeight);

  // An extruded geometry turns a 2D shape into 3D by giving it a depth
  const fieldGeometry = new THREE.ExtrudeBufferGeometry(
    [islandLeft, islandRight, islandMiddle, outerField],
    { depth: 6, bevelEnabled: false }
  );

  const fieldMesh = new THREE.Mesh(fieldGeometry, [
    new THREE.MeshLambertMaterial({
      // Either set a plain color or a texture depending on config
      color: !config.curbs && lawnGreen,
      map: config.curbs && curbsTexture
    }),
    new THREE.MeshLambertMaterial({ color: 0x23311c })
  ]);
  fieldMesh.receiveShadow = true;
  fieldMesh.matrixAutoUpdate = false;
  scene.add(fieldMesh);

  positionScoreElement();

  if (config.trees) {
    const tree1 = Tree();
    tree1.position.x = arcCenterX * 1.3;
    scene.add(tree1);

    const tree2 = Tree();
    tree2.position.y = arcCenterX * 1.9;
    tree2.position.x = arcCenterX * 1.3;
    scene.add(tree2);

    const tree3 = Tree();
    tree3.position.x = arcCenterX * 0.8;
    tree3.position.y = arcCenterX * 2;
    scene.add(tree3);

    const tree4 = Tree();
    tree4.position.x = arcCenterX * 1.8;
    tree4.position.y = arcCenterX * 2;
    scene.add(tree4);

    const tree5 = Tree();
    tree5.position.x = -arcCenterX * 1;
    tree5.position.y = arcCenterX * 2;
    scene.add(tree5);

    const tree6 = Tree();
    tree6.position.x = -arcCenterX * 2;
    tree6.position.y = arcCenterX * 1.8;
    scene.add(tree6);

    const tree7 = Tree();
    tree7.position.x = arcCenterX * 0.8;
    tree7.position.y = -arcCenterX * 2;
    scene.add(tree7);

    const tree8 = Tree();
    tree8.position.x = arcCenterX * 1.8;
    tree8.position.y = -arcCenterX * 2;
    scene.add(tree8);

    const tree9 = Tree();
    tree9.position.x = -arcCenterX * 1;
    tree9.position.y = -arcCenterX * 2;
    scene.add(tree9);

    const tree10 = Tree();
    tree10.position.x = -arcCenterX * 2;
    tree10.position.y = -arcCenterX * 1.8;
    scene.add(tree10);

    const tree11 = Tree();
    tree11.position.x = arcCenterX * 0.6;
    tree11.position.y = -arcCenterX * 2.3;
    scene.add(tree11);

    const tree12 = Tree();
    tree12.position.x = arcCenterX * 1.5;
    tree12.position.y = -arcCenterX * 2.4;
    scene.add(tree12);

    const tree13 = Tree();
    tree13.position.x = -arcCenterX * 0.7;
    tree13.position.y = -arcCenterX * 2.4;
    scene.add(tree13);

    const tree14 = Tree();
    tree14.position.x = -arcCenterX * 1.5;
    tree14.position.y = -arcCenterX * 1.8;
    scene.add(tree14);
  }
}

function getCarFrontTexture() {
  const canvas = document.createElement("canvas");
  canvas.width = 64;
  canvas.height = 32;
  const context = canvas.getContext("2d");

  context.fillStyle = "#ffffff";
  context.fillRect(0, 0, 64, 32);

  context.fillStyle = "#666666";
  context.fillRect(8, 8, 48, 24);

  return new THREE.CanvasTexture(canvas);
}

function getCarSideTexture() {
  const canvas = document.createElement("canvas");
  canvas.width = 128;
  canvas.height = 32;
  const context = canvas.getContext("2d");

  context.fillStyle = "#ffffff";
  context.fillRect(0, 0, 128, 32);

  context.fillStyle = "#666666";
  context.fillRect(10, 8, 38, 24);
  context.fillRect(58, 8, 60, 24);

  return new THREE.CanvasTexture(canvas);
}

function Car() {
  const car = new THREE.Group();

  const color = pickRandom(vehicleColors);

  const main = new THREE.Mesh(
    new THREE.BoxBufferGeometry(60, 30, 15),
    new THREE.MeshLambertMaterial({ color })
  );
  main.position.z = 12;
  main.castShadow = true;
  main.receiveShadow = true;
  car.add(main);

  const carFrontTexture = getCarFrontTexture();
  carFrontTexture.center = new THREE.Vector2(0.5, 0.5);
  carFrontTexture.rotation = Math.PI / 2;

  const carBackTexture = getCarFrontTexture();
  carBackTexture.center = new THREE.Vector2(0.5, 0.5);
  carBackTexture.rotation = -Math.PI / 2;

  const carLeftSideTexture = getCarSideTexture();
  carLeftSideTexture.flipY = false;

  const carRightSideTexture = getCarSideTexture();

  const cabin = new THREE.Mesh(new THREE.BoxBufferGeometry(33, 24, 12), [
    new THREE.MeshLambertMaterial({ map: carFrontTexture }),
    new THREE.MeshLambertMaterial({ map: carBackTexture }),
    new THREE.MeshLambertMaterial({ map: carLeftSideTexture }),
    new THREE.MeshLambertMaterial({ map: carRightSideTexture }),
    new THREE.MeshLambertMaterial({ color: 0xffffff }), // top
    new THREE.MeshLambertMaterial({ color: 0xffffff }) // bottom
  ]);
  cabin.position.x = -6;
  cabin.position.z = 25.5;
  cabin.castShadow = true;
  cabin.receiveShadow = true;
  car.add(cabin);

  const backWheel = new Wheel();
  backWheel.position.x = -18;
  car.add(backWheel);

  const frontWheel = new Wheel();
  frontWheel.position.x = 18;
  car.add(frontWheel);

  if (config.showHitZones) {
    car.userData.hitZone1 = HitZone();
    car.userData.hitZone2 = HitZone();
  }

  return car;
}

function getTruckFrontTexture() {
  const canvas = document.createElement("canvas");
  canvas.width = 32;
  canvas.height = 32;
  const context = canvas.getContext("2d");

  context.fillStyle = "#ffffff";
  context.fillRect(0, 0, 32, 32);

  context.fillStyle = "#666666";
  context.fillRect(0, 5, 32, 10);

  return new THREE.CanvasTexture(canvas);
}

function getTruckSideTexture() {
  const canvas = document.createElement("canvas");
  canvas.width = 32;
  canvas.height = 32;
  const context = canvas.getContext("2d");

  context.fillStyle = "#ffffff";
  context.fillRect(0, 0, 32, 32);

  context.fillStyle = "#666666";
  context.fillRect(17, 5, 15, 10);

  return new THREE.CanvasTexture(canvas);
}

function Truck() {
  const truck = new THREE.Group();
  const color = pickRandom(vehicleColors);

  const base = new THREE.Mesh(
    new THREE.BoxBufferGeometry(100, 25, 5),
    new THREE.MeshLambertMaterial({ color: 0xb4c6fc })
  );
  base.position.z = 10;
  truck.add(base);

  const cargo = new THREE.Mesh(
    new THREE.BoxBufferGeometry(75, 35, 40),
    new THREE.MeshLambertMaterial({ color: 0xffffff }) // 0xb4c6fc
  );
  cargo.position.x = -15;
  cargo.position.z = 30;
  cargo.castShadow = true;
  cargo.receiveShadow = true;
  truck.add(cargo);

  const truckFrontTexture = getTruckFrontTexture();
  truckFrontTexture.center = new THREE.Vector2(0.5, 0.5);
  truckFrontTexture.rotation = Math.PI / 2;

  const truckLeftTexture = getTruckSideTexture();
  truckLeftTexture.flipY = false;

  const truckRightTexture = getTruckSideTexture();

  const cabin = new THREE.Mesh(new THREE.BoxBufferGeometry(25, 30, 30), [
    new THREE.MeshLambertMaterial({ color, map: truckFrontTexture }),
    new THREE.MeshLambertMaterial({ color }), // back
    new THREE.MeshLambertMaterial({ color, map: truckLeftTexture }),
    new THREE.MeshLambertMaterial({ color, map: truckRightTexture }),
    new THREE.MeshLambertMaterial({ color }), // top
    new THREE.MeshLambertMaterial({ color }) // bottom
  ]);
  cabin.position.x = 40;
  cabin.position.z = 20;
  cabin.castShadow = true;
  cabin.receiveShadow = true;
  truck.add(cabin);

  const backWheel = Wheel();
  backWheel.position.x = -30;
  truck.add(backWheel);

  const middleWheel = Wheel();
  middleWheel.position.x = 10;
  truck.add(middleWheel);

  const frontWheel = Wheel();
  frontWheel.position.x = 38;
  truck.add(frontWheel);

  if (config.showHitZones) {
    truck.userData.hitZone1 = HitZone();
    truck.userData.hitZone2 = HitZone();
    truck.userData.hitZone3 = HitZone();
  }

  return truck;
}

function HitZone() {
  const hitZone = new THREE.Mesh(
    new THREE.CylinderGeometry(20, 20, 60, 30),
    new THREE.MeshLambertMaterial({ color: 0xff0000 })
  );
  hitZone.position.z = 25;
  hitZone.rotation.x = Math.PI / 2;

  scene.add(hitZone);
  return hitZone;
}

function Wheel() {
  const wheel = new THREE.Mesh(wheelGeometry, wheelMaterial);
  wheel.position.z = 6;
  wheel.castShadow = false;
  wheel.receiveShadow = false;
  return wheel;
}

function Tree() {
  const tree = new THREE.Group();

  const trunk = new THREE.Mesh(treeTrunkGeometry, treeTrunkMaterial);
  trunk.position.z = 10;
  trunk.castShadow = true;
  trunk.receiveShadow = true;
  trunk.matrixAutoUpdate = false;
  tree.add(trunk);

  const treeHeights = [45, 60, 75];
  const height = pickRandom(treeHeights);

  const crown = new THREE.Mesh(
    new THREE.SphereGeometry(height / 2, 30, 30),
    treeCrownMaterial
  );
  crown.position.z = height / 2 + 30;
  crown.castShadow = true;
  crown.receiveShadow = false;
  tree.add(crown);

  return tree;
}

 $("#accelerate").bind('touchstart', function(){
   
        startGame();
        accelerate = true;
   
  }).bind('touchend', function(){
   
      accelerate = false;
  });
    
 $("#decelerate").bind('touchstart', function(){

  startGame();
  decelerate = true;

}).bind('touchend', function(){

  decelerate = false;
});/*
 accelerateButton.addEventListener("mouseover", function () {
  startGame();
  accelerate = true;
});
decelerateButton.addEventListener("mouseover", function () {
  startGame();
  decelerate = true;
});
accelerateButton.addEventListener("mouseout", function () {
  accelerate = false;
});
decelerateButton.addEventListener("mouseout", function () {
  decelerate = false;
});*/
window.addEventListener("keydown", function (event) {
  if (event.key == "ArrowUp") {
    startGame();
    accelerate = true;
    return;
  }
  if (event.key == "ArrowDown") {
    decelerate = true;
    return;
  }
  if (event.key == "R" || event.key == "r") {
    reset();
    return;
  }
});
window.addEventListener("keyup", function (event) {
  if (event.key == "ArrowUp") {
    accelerate = false;
    return;
  }
  if (event.key == "ArrowDown") {
    decelerate = false;
    return;
  }
});

function animation(timestamp) {
  if (!lastTimestamp) {
    lastTimestamp = timestamp;
    return;
  }

  const timeDelta = timestamp - lastTimestamp;

  movePlayerCar(timeDelta);

  const laps = Math.floor(Math.abs(playerAngleMoved) / (Math.PI * 2));

  // Update score if it changed
  if (laps != score) {
    score = laps;
    scoreElement.innerText = score;
  }

  // Add a new vehicle at the beginning and with every 5th lap
  if (otherVehicles.length < (laps + 1) / 5) addVehicle();

  moveOtherVehicles(timeDelta);

  hitDetection();

  renderer.render(scene, camera);
  lastTimestamp = timestamp;
}

function movePlayerCar(timeDelta) {
  const playerSpeed = getPlayerSpeed();
  playerAngleMoved -= playerSpeed * timeDelta;

  const totalPlayerAngle = playerAngleInitial + playerAngleMoved;

  const playerX = Math.cos(totalPlayerAngle) * trackRadius - arcCenterX;
  const playerY = Math.sin(totalPlayerAngle) * trackRadius;

  playerCar.position.x = playerX;
  playerCar.position.y = playerY;

  playerCar.rotation.z = totalPlayerAngle - Math.PI / 2;
}

function moveOtherVehicles(timeDelta) {
  otherVehicles.forEach((vehicle) => {
    if (vehicle.clockwise) {
      vehicle.angle -= speed * timeDelta * vehicle.speed;
    } else {
      vehicle.angle += speed * timeDelta * vehicle.speed;
    }

    const vehicleX = Math.cos(vehicle.angle) * trackRadius + arcCenterX;
    const vehicleY = Math.sin(vehicle.angle) * trackRadius;
    const rotation =
      vehicle.angle + (vehicle.clockwise ? -Math.PI / 2 : Math.PI / 2);
    vehicle.mesh.position.x = vehicleX;
    vehicle.mesh.position.y = vehicleY;
    vehicle.mesh.rotation.z = rotation;
  });
}

function getPlayerSpeed() {
  if (accelerate) return speed * 2;
  if (decelerate) return speed * 0.5;
  return speed;
}

function addVehicle() {
  const vehicleTypes = ["car", "truck"];

  const type = pickRandom(vehicleTypes);
  const speed = getVehicleSpeed(type);
  const clockwise = Math.random() >= 0.5;

  const angle = clockwise ? Math.PI / 2 : -Math.PI / 2;

  const mesh = type == "car" ? Car() : Truck();
  scene.add(mesh);

  otherVehicles.push({ mesh, type, speed, clockwise, angle });
}

function getVehicleSpeed(type) {
  if (type == "car") {
    const minimumSpeed = 1;
    const maximumSpeed = 2;
    return minimumSpeed + Math.random() * (maximumSpeed - minimumSpeed);
  }
  if (type == "truck") {
    const minimumSpeed = 0.6;
    const maximumSpeed = 1.5;
    return minimumSpeed + Math.random() * (maximumSpeed - minimumSpeed);
  }
}

function getHitZonePosition(center, angle, clockwise, distance) {
  const directionAngle = angle + clockwise ? -Math.PI / 2 : +Math.PI / 2;
  return {
    x: center.x + Math.cos(directionAngle) * distance,
    y: center.y + Math.sin(directionAngle) * distance
  };
}

function hitDetection() {
  const playerHitZone1 = getHitZonePosition(
    playerCar.position,
    playerAngleInitial + playerAngleMoved,
    true,
    15
  );

  const playerHitZone2 = getHitZonePosition(
    playerCar.position,
    playerAngleInitial + playerAngleMoved,
    true,
    -15
  );

  if (config.showHitZones) {
    playerCar.userData.hitZone1.position.x = playerHitZone1.x;
    playerCar.userData.hitZone1.position.y = playerHitZone1.y;

    playerCar.userData.hitZone2.position.x = playerHitZone2.x;
    playerCar.userData.hitZone2.position.y = playerHitZone2.y;
  }

  const hit = otherVehicles.some((vehicle) => {
    if (vehicle.type == "car") {
      const vehicleHitZone1 = getHitZonePosition(
        vehicle.mesh.position,
        vehicle.angle,
        vehicle.clockwise,
        15
      );

      const vehicleHitZone2 = getHitZonePosition(
        vehicle.mesh.position,
        vehicle.angle,
        vehicle.clockwise,
        -15
      );

      if (config.showHitZones) {
        vehicle.mesh.userData.hitZone1.position.x = vehicleHitZone1.x;
        vehicle.mesh.userData.hitZone1.position.y = vehicleHitZone1.y;

        vehicle.mesh.userData.hitZone2.position.x = vehicleHitZone2.x;
        vehicle.mesh.userData.hitZone2.position.y = vehicleHitZone2.y;
      }

      // The player hits another vehicle
      if (getDistance(playerHitZone1, vehicleHitZone1) < 40) return true;
      if (getDistance(playerHitZone1, vehicleHitZone2) < 40) return true;

      // Another vehicle hits the player
      if (getDistance(playerHitZone2, vehicleHitZone1) < 40) return true;
    }

    if (vehicle.type == "truck") {
      const vehicleHitZone1 = getHitZonePosition(
        vehicle.mesh.position,
        vehicle.angle,
        vehicle.clockwise,
        35
      );

      const vehicleHitZone2 = getHitZonePosition(
        vehicle.mesh.position,
        vehicle.angle,
        vehicle.clockwise,
        0
      );

      const vehicleHitZone3 = getHitZonePosition(
        vehicle.mesh.position,
        vehicle.angle,
        vehicle.clockwise,
        -35
      );

      if (config.showHitZones) {
        vehicle.mesh.userData.hitZone1.position.x = vehicleHitZone1.x;
        vehicle.mesh.userData.hitZone1.position.y = vehicleHitZone1.y;

        vehicle.mesh.userData.hitZone2.position.x = vehicleHitZone2.x;
        vehicle.mesh.userData.hitZone2.position.y = vehicleHitZone2.y;

        vehicle.mesh.userData.hitZone3.position.x = vehicleHitZone3.x;
        vehicle.mesh.userData.hitZone3.position.y = vehicleHitZone3.y;
      }

      // The player hits another vehicle
      if (getDistance(playerHitZone1, vehicleHitZone1) < 40) return true;
      if (getDistance(playerHitZone1, vehicleHitZone2) < 40) return true;
      if (getDistance(playerHitZone1, vehicleHitZone3) < 40) return true;

      // Another vehicle hits the player
      if (getDistance(playerHitZone2, vehicleHitZone1) < 40) return true;
    }
  });

  if (hit) {
    if (resultsElement) resultsElement.style.display = "flex";
    renderer.setAnimationLoop(null); // Stop animation loop
  }
}

window.addEventListener("resize", () => {
  console.log("resize", window.innerWidth, window.innerHeight);

  // Adjust camera
  const newAspectRatio = window.innerWidth / window.innerHeight;
  const adjustedCameraHeight = cameraWidth / newAspectRatio;

  camera.top = adjustedCameraHeight / 2;
  camera.bottom = adjustedCameraHeight / -2;
  camera.updateProjectionMatrix(); // Must be called after change

  positionScoreElement();

  // Reset renderer
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.render(scene, camera);
});

  </script>

</body>
</html>
